# 네트워크 기기의 처리 범위

계층별로 네트워크 기기의 처리 범위를 나눌 수 있다.

> 상위 계층을 처리하는 기기는 하위 계층을 처리할 수 있지만 그 반대는 불가

-   애플리케이션 계층 : L7 스위치
-   전송 계층 : L4 스위치
-   인터넷 계층 : 라우터, L3 스위치
-   데이터 링크 계층 : 브리지, L2 스위치
-   물리 계층 : NIC, 리피터, AP

## 스위치란?

[![1.png](https://i.postimg.cc/7h8wxhBz/1.png)](https://postimg.cc/CBNW7hpM)

-   네트워크 스위치는 컴퓨터와 같은 2개 이상의 IT 디바이스가 서로 통신하도록 허용하는 장비
-   스위치는 자신에게 연결된 모든 기기들로부터 들어오는 패킷을 수신하고 이 패킷을 적당한 기기로 보냄
-   허브의 확장된 개념으로 기본 기능은 허브와 동일하지만 전송 중 패킷의 충돌이 일어나지 않도록 패킷의 목적지로 지정할 포트를 직접 전송한다.
-   네트워크 스위치는 네트워크(종종 근거리 통신망, 즉 LAN) 내의 장치를 연결하고 해당 장치와 데이터 패킷을 주고받습니다. 라우터와 달리 스위치는 여러 장치의 네트워크가 아닌 의도된 단일 장치(다른 스위치, 라우터, 사용자 컴퓨터일 수 있음)로만 데이터를 전송합니다.
-   OSI 7계층에서 어느 계층까지 다루는지 기준으로 스위치의 종류를 나눔

[![1.jpg](https://i.postimg.cc/1Xb3V7JG/1.jpg)](https://postimg.cc/D4dTt6V0)

## 네트워크를 이루는 장치, 애플리케이션 계층

### 애플리케이션 계층

**애플리케이션 계층**은 FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며, 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 계층입니다.

### L7 스위치

-   애플리케이션 계층(=응용계층)을 처리
-   여러 장비를 연결하고 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기 신호를 보낸다
-   데이터를 전송하는 통신 네트워크 장비
-   로드밸런서라고도 한다(= 정교한 로드밸런싱 가능)
    <details>
    <summary>💡로드밸런서?</summary>
    <div>

    [![1.png](https://i.postimg.cc/1z7NL3fS/1.png)](https://postimg.cc/DWsZGFrp)

    로드밸런서는 서버에 가해지는 부하(=로드)를 분산(=밸런싱)해주는 장치 또는 기술을 통칭합니다. 클라이언트와 서버풀(Server Pool, 분산 네트워크를 구성하는 서버들의 그룹)사이에 위치하며, 한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리해 각각의 서버가 최적의 퍼포먼스를 보일 수 있도록 합니다.

    </div>

    </details>

-   서버의 부하를 분산하는 기기
-   클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 하며 시스템이 처리할 수 있는 트래픽 증가를 목표로 한다
-   웹 방화벽, 보안 스위치가 여기에 포함된다.
-   사실상 스위치보다는 보안장비라고 봐도 무방하다.
-   페이로드 분석(=보내고자 하는 데이터 자체)에 많은 자원을 소모하므로 병목현상 발생 가능

            L7 스위치 주요 기능

            -   url, 서버, 캐시, 쿠키들을 기반으로 트래픽을 분산한다
            -   바이러스, 불필요한 외부 데이터 등을 걸러내는 필터링 기능
            -   응용 프로그램 수준의 트래픽 모니터링이 가능
            > 장애가 발생한 서버가 있다면 이를 트래픽 분산 대상에서 제외해야 한다

-   이는 정기적으로 헬스 체크를 이용하여 감시하면서 이루어진다
    <details>
    <summary>💡헬스 체크?</summary>
    <div>
        
    미리 답이 정해진 일정한 규칙을 실행시켜 장애의 유무를 결정하고, 필요할 때는 장애 단위를 분리시키는 컴퓨터의 자기 진단 기능이다.

    L4 스위치 또는 L7스위치 모두 헬스 체크를 통해 정상적인 서버 또는 비정상적인 서버를 판별하는데, 헬스 체크는 전송 주기와 재전송 횟수 등을 설정한 이후 반복적으로 서버에 요청을 보내는 것을 말한다. 예를들어 TCP요청을 보냈는데 3-WAY HANDSHAKE가 정상적으로 일어나지 않았다면 정상이 아닌 경우이다.
    </div>

    </details>

### 로드밸런서를 이용한 서버 이중화

[![11111.png](https://i.postimg.cc/NFWb6x1K/11111.png)](https://postimg.cc/T5JrGgNx)

-   로드밸런서의 대표적인 기능으로 서버 이중화를 들 수 있다. 서비스를 안정적으로 운용하기 위해서는 2대 이상의 서버가 필수적이다. 에러가 발생하여 서버 1대가 종료되더라도, 서비스는 안정적으로 운용되어야 하기 때문이다.
-   로드밸런서는 2대 이상의 서버를 기반으로 가상 IP를 제공하고 이를 기반으로 안정적인 서비스를 제공한다.
-   다음 그림처럼 로드 밸런서가 제공한 0.0.0.12010이란 가상 IP에 사용자들이 접근하고, 뒷단에 사용가능항 서버인 0.0.0.12011과 0.0.0.12012를 기반으로 서빙한다. 이렇게하면 0.0.0.12011이란 서버에 장애가 발생해도 그것과는 무방하게 0.0.0.12012서버를 기반으로 안정적인 서비스를 운용할 수 있다.
-   이외에도 클라이언트가 호스트에 직접 접촉하는 것을 방지하여 내부 네트워크 구조를 숨기고 클라이언트가 호스트와 직접 상호작용하는 것을 방지하는 보안 이점이 잇다.
-   참고로 클라우드 서비스(AWS)등에서 L7스위치를 이용한 로드밸런싱은 ALB(Application Load Balancer)컴포넌트로 하며, L4스위치를 이용한 로드밸런싱은 NLB(Network Load Balancer)컴포넌트라고 한다.

## 네트워크를 이루는 장치, 전송 계층

### 전송 계층

**전송 계층(Transport layer)** 은 계층 구조의 네트워크 구성요소와 프로토콜 내에서 송신자와 수신자를 연결하는 통신 서비스를 제공한다.

[![1.png](https://i.postimg.cc/J7Z9xT6r/1.png)](https://postimg.cc/Dmfjyc3H)

-   로드밸런서의 이점(안정화, 보안)을 가지고 있음
-   부하분산
-   상위계층의 패킷을 분석해 트래픽의 우선순위를 부여할 수 있음
    -   예를 들어 HTTP는 패킷 중 포트번호 80에 우선순위 부여
-   헤더를 분석해서 부하 분산을 할 수 있음
-   전송계층에서 동작한다.
-   L2만큼 많이 사용되고 있다.(L2 스위치는 데이터링크 계층에서 작동한다. 또한 가장 기본적인 스위치이며 저렴하다.)
-   서버나 네트워크의 트래픽을 로드밸런싱(Load Balancing) 할 수 있다.
-   TCP, UDP등의 헤더를 보고 FTP,HTTP,SMTP등 어떤 프로토콜인지 확인하여 스위칭의 우선 순위를 부여한다.
-   IP주소와 Port를 기반으로 스위칭한다.
-   L4 스위치 수행기능(L3의 기능 모두 수행, 그룹화, 부하분산)

## (정리) L4 스위치와 L7 스위치 차이

### L4 스위치

-   로드밸런서
-   스트리밍 관련 서비스에서 사용할 수 없다
-   메시지를 기반으로 인식하지 못한다
-   전송 계층인 OSI 모델의 4번째 계층에서 동작합니다.
-   주로 IP 주소, 포트 번호 등의 정보를 기반으로 트래픽을 분산시킵니다.
-   L4 스위치를 이용한 로드밸런싱은 NLB 컴포넌트로 한다
-   서비스 포트 단위로 로드 밸런싱 수행

### L7 스위치

-   애플리케이션 계층을 처리하는 기기
-   트래픽을 보다 상세하게 검사하고 처리합니다.
-   HTTP/HTTPS 프로토콜과 같은 애플리케이션 레이어의 정보를 기반으로 로드 밸런싱을 수행합니다. IP, 포트 외에도 URL, 트래픽 패턴, 쿠키, HTTP 헤더 등을 고려하여 서버로의 분산을 결정합니다.
-   ALB 컴포넌트로 한다
-   데이터 단위로 로드 밸런싱 수행
<details>
    <summary>💡ALB(Application Load Balancer)?</summary>
    <div>
    - ALB는 L7의 로드 밸런서를 지원합니다. </br>
    - ALB는 HTTP/HTTPS 프로토콜의 헤더를 보고 적절한 패킷으로 전송합니다. </br>
    - ALB는 IP주소 + 포트번호 + 패킷 내용을 보고 스위칭합니다. </br>
    - ALB는 L7단을 지원하기 때문에 SSL 적용이 가능합니다. (SSL: 보안 소켓 계층(Secure Sockets Layer)은 웹사이트와 브라우저 사이(또는 두 서버 사이)에 전송되는 데이터를 암호화하여 인터넷 연결을 보호하기 위한 표준 기술)
    </div>

</details>
<details>
    <summary>💡NLB(Network Load Balancer)?</summary>
    <div>
    - NLB는 L4의 로드 밸런서를 지원합니다. </br>
    - NLB는 TCP/IP 프로토콜의 헤더를 보고 적절한 패킷으로 전송합니다. </br>
    - NLB는 IP + 포트번호를 보고 스위칭합니다. </br>
    - NLB는 SSL 적용이 인프라 단에서 불가능하여 애플리케이션에서 따로 적용해 주어야 합니다. </br>
    - NLB의 장점은 클라이언트 요청에 대해서 적은 대기 시간이 걸린다. NLB는 네트워크 계층까지만 확인하기 때문에 7계층인 ALB보다 빠르다.
    </div>

</details>


문제 1.다음 L4스위치에 대한 설명 중 틀린 것은?
1) HTTP URL 기반의  패킷 스위칭을 수행한다.
2) 패킷 전달과정에서 네트워크나  서버의 효율을  고려한다.
3) 전송계층의 포트번호를  통해서 응용계층  서비스를 구분한다.
4) 서버의 부하에 따라 세그먼트를 적절히 배분하는 SLB(Server Load Balancing) 기능을  가진다.

문제 2. L4 스위치의 기능이 아닌 것은?
1) 사용자들의 요구를 서버들의 부하 분배상태에 따라서 배분한다.
2) 특정 응용 프로그램의 트래픽 전송을 차단할 수 있다.
3) 네트워크 트래픽 분류를 위해 TCP/UDP port 정보를 활용한다.
4) 웹 캐슁(Web caching)을 수행하여 정보를 입수하기 까지의 지연시간을 줄인다.




<details>
    <summary>답</summary>
    <div>
    해설:  1번 -> HTTP URL은 Application 계층이다. L4는 전달망 계층임
    </div>
     해설:  4번 -> 캐쉬 기능을 직접 수행하는 것이 아니고 캐쉬 서버로 리다이렉션 기능을 지원함
</details>
