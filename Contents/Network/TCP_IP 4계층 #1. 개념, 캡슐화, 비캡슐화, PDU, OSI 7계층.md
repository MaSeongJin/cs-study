## OSI 7계층과 TCP/ICP 4계층

> 계층 모형이란?
> 
> TCP/IP 모형은 현재의 인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 통신규약(프로토콜)의 모음으로 각 계층은 담당하는 위치마다 처리 역할을 구분해 진행함으로 서로 간의 간섭을 최소화하여 사용의 편리성을 높힌다.
> 
> - 호환성 보장(다른 제조사 장비들끼리도 통신 가능)으로 인한 비용 절감
> - 쉬운 문제 해결(계층별로 문제 확인 가능)
> - 다른 계층끼리는 각 전달 과정을 알 필요없어 데이터의 캡슐화(헤더첨부)와 은닉이 가능

- 국제표준화기구 IOS(International Organization for Standardization)에서는 상호 이질적인 네트워크간의 연결에서 호환성의 결여를 막기위해 OSI(Open Systems Interconnection) 모형을 개발했다.
- 실제 사용되는 TCP/IP는 OSI 참조 모델을 기반으로 상업적이고 실무적으로 이용될 수 있도록 단순화된 모형이다
  - 네트워크 전송 시 데이터 표준을 정리한 것이 OSI 7계층, 이 이론을 실제 사용하는 인터넷 표준이 TCP/IP 4계층이다.

<p align="center"><img src="https://i.postimg.cc/sXWJWrZP/image.png"></p>

## OSI 7계층

### 1계층 - 물리계층(Physical Layer)

이 계층에서는 주로 전기적, 기계적, 기능적인 특성을 이용해서 통신 케이블로 데이터를 전송하게 된다. 

이 계층에서 사용되는 통신 단위는 비트이며 이것은 1과 0으로 나타내어지는, 즉 전기적으로 On, Off 상태라고 생각하면 된다. 

이 계층에서는 단지 데이터를 전달만 할뿐 전송하려는(또는 받으려는)**데이터가 무엇인지, 어떤 에러가 있는지 등에는 전혀 신경 쓰지 않는다.** 

단지 데이터 전기적인 신호로 변환해서 주고받는 기능만 할 뿐이다. 이 계층에 속하는 대표적인 장비는 **통신 케이블, 리피터, 허브**등이 있다.

->**케이블, 리피터, 허브등을 통해 데이터 전송한다.**

<p align="center"><img src="https://i.postimg.cc/2yVLWdts/image.png"></p>

### 2계층 - 데이터 링크계층(DataLink Layer)

물리계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 **정보의 전달을 수행**할 수 있도록 도와주는 역할을 한다. 따라서 통신에서의 오류도 찾아주고 재전송도 하는 기능을 가지고 있다. 이 계층에서는 **맥 주소를 가지고 통신**하게 된다. 

이 계층에서 전송되는 단위를 프레임이라고 하고, 대표적인 장비로는 **브리지, 스위치** 등이 있다.(여기서 MAC주소를 사용한다.)

-> **브릿지나 스위치를 통해 맥주소를 가지고 물리계층에서 받은 정보를 전달함**.

데이터 링크 계층(Data link layer)은 포인트 투 포인트(Point to Point) 간 신뢰성있는 전송을 보장하기 위한 계층으로 CRC 기반의 오류 제어와 흐름 제어가 필요하다. 네트워크 위의 개체들 간 데이터를 전달하고, 물리 계층에서 발생할 수 있는 오류를 찾아 내고, 수정하는 데 필요한 기능적, 절차적 수단을 제공한다. 

주소 값은 물리적으로 할당 받는데, 이는 네트워크 카드가 만들어질 때부터 맥 주소(MAC address)가 정해져 있다는 뜻이다. 주소 체계는 계층이 없는 단일 구조이다. 데이터 링크 계층의 가장 잘 알려진 예는 이더넷이다. 

이 외에도 HDLC나 ADCCP 같은 포인트 투 포인트(point-to-point) 프로토콜이나 패킷 스위칭 네트워크나 LLC, ALOHA 같은 근거리 네트워크용 프로토콜이 있다. 

네트워크 브릿지나 스위치 등이 이 계층에서 동작하며, 직접 이어진 곳에만 연결할 수 있다.

**-> 프레임에 주소부여(MAC - 물리적주소)**

**에러검출/재전송/흐름제어**

<p align="center"><img src="https://i.postimg.cc/XNC5kW7m/img1-daumcdn.jpg"></p>

### 3계층 - 네트워크 계층(Network Layer)

이 계층에서 가장 중요한 기능은 **데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능(라우팅)** 이다. 여기에 사용되는 프로토콜의 종류도 다양하고, 라우팅하는 기술도 다양하다.

이 계층은 경로를 선택하고 주소를 정하고 경로에 따라 패킷을 전달해주는 것이 이 계층의 역할이다. 이 계층의 대표적인 장비는 라우터이며, 요즘은 2계층의 장비 중 스위치라는 장비에 라우팅 기능을 장착한 Layer 3 스위치도 있다.

네트워크 계층(Network layer)은 여러개의 노드를 거칠때마다 경로를 찾아주는 역할을 하는 계층으로 다양한 길이의 데이터를 네트워크들을 통해 전달하고, 그 과정에서 전송 계층이 요구하는 서비스 품질(QoS)을 제공하기 위한 기능적, 절차적 수단을 제공한다. 

네트워크 계층은 라우팅, 흐름 제어, 세그멘테이션(segmentation/desegmentation), 오류 제어, 인터네트워킹(Internetworking) 등을 수행한다. 

라우터가 이 계층에서 동작하고 이 계층에서 동작하는 스위치도 있다. 

데이터를 연결하는 다른 네트워크를 통해 전달함으로써 인터넷이 가능하게 만드는 계층이다. 논리적인 주소 구조(IP), 곧 네트워크 관리자가 직접 주소를 할당하는 구조를 가지며, 계층적(hierarchical)이다.

서브네트의 최상위 계층으로 경로를 설정하고, 청구 정보를 관리한다. 개방형 시스템들의 사이에서 네트워크 연결을 설정, 유지, 해제하는 기능을 부여하고, 전송 계층 사이에 네트워크 서비스 데이터 유닛(NSDU : Network Service Data Unit)을 교환하는 기능을 제공한다.

-> **주소부여(IP), 경로설정(Route)**

### 4계층 - 전송 계층(Transport Layer)

통신을 활성화하기 위한 계층이다. 보통 TCP프로토콜을 이용하며, 포트를 열어서 응용프로그램들이 전송을 할 수 있게 한다. 만약 데이터가 왔다면 4계층에서 해당 데이터를 하나로 합쳐서 5계층에 던져 준다. 

단대단 오류제어 및 흐름제어 이 계층 까지는 물리적인 계층에 속한다.(TCP/UDP프로토콜을 사용한다.)

전송 계층(Transport layer)은 양 끝단(End to end)의 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해 주어, 상위 계층들이 데이터 전달의 유효성이나 효율성을 생각하지 않도록 해준다. 

시퀀스 넘버 기반의 오류 제어 방식을 사용한다. 

전송 계층은 특정 연결의 유효성을 제어하고, 일부 프로토콜은 상태 개념이 있고(stateful), **연결 기반(connection oriented)** 이다. 이는 **전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것**을 뜻한다. 

가장 잘 알려진 전송 계층의 예는 TCP이다. 종단간(end-to-end) 통신을 다루는 최하위 계층으로 종단간 신뢰성 있고 효율적인 데이터를 전송하며, 기능은 오류검출 및 복구와 흐름제어, 중복검사 등을 수행한다.

-> **패킷 생성(Assembly/Sequencing/Deassembly/Error detection/Request repeat/Flow control) 및 전송**

### 5계층 - 세션 계층(Session Layer)

**데이터가 통신하기 위한 논리적인 연결**을 말한다. 통신을 하기위한 대문이라고 보면 된다. 

하지만 4계층에서도 연결을 맺고 종료할 수 있기 때문에 우리가 어느 계층에서 통신이 끊어 졌나 판단하기는 한계가 있다. 그러므로 세션 계층은 4 계층과 무관하게 응용 프로그램 관점에서 봐야 한다. 세션 설정, 유지, 종료, 전송 중단시 복구 등의 기능이 있다.

세션 계층(Session layer)은 양 끝단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공한다. 

**동시 송수신 방식(duplex), 반이중 방식(half-duplex), 전이중 방식(Full Duplex)** 의 통신과 함께, 체크 포인팅과 유휴, 종료, 다시 시작 과정 등을 수행한다. 

이 계층은 **TCP/IP 세션을 만들고 없애는 책임**을 진다.

**-> 통신하는 사용자들을 동기화하고 오류복구 명령들을 일괄적으로 다룬다.**

**통신을 하기 위한 세션을 확립/유지/중단 (운영체제가 해줌)**

### 6계층 - 표현 계층(Presentation Layer)

데이터 표현이 상이한 응용 프로세스의 독립성을 제공하고, 암호화 한다.

표현 계층(Presentation layer)은 코드 간의 번역을 담당하여 사용자 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다. MIME 인코딩이나 암호화 등의 동작이 이 계층에서 이루어진다. 

예를 들면, EBCDIC로 인코딩된 문서 파일을 ASCII로 인코딩된 파일로 바꿔 주는 것,  

해당 데이터가 TEXT인지, 그림인지, GIF인지 JPG인지의 구분 등이 표현 계층의 몫이다.

**-> 사용자의 명령어를 완성및 결과 표현. 포장/압축/암호화**

### 7계층 - 응용 계층(Application Layer)

최종 목적지로서 HTTP, FTP, SMTP, POP3, IMAP, Telnet 등과 같은 프로토콜이 있다. 

해당 통신 패킷들은 방금 나열한 프로토콜에 의해 모두 처리되며 우리가 사용하는 브라우저나, 메일 프로그램은 프로토콜을 보다 쉽게 사용하게 해주는 응용프로그램이다. 한마디로 모든 통신의 양 끝단은 HTTP와 같은 프로토콜이지 응용프로그램이 아니다.

응용 계층(Application layer)은 응용 프로세스와 직접 관계하여 일반적인 **응용 서비스를 수행**한다. 일반적인 응용 서비스는 관련된 응용 프로세스들 사이의 전환을 제공한다. 

응용 서비스의 예로, 가상 터미널(예를 들어, **텔넷**), "Job transfer and Manipulation protocol" (JTM, 표준 ISO/IEC 8832) 등이 있다.

**-> 네트워크 소프트웨어 UI 부분, 사용자의 입출력(I/O)부분**

## TCP/IP 4계층

### 1계층 - 네트워크 연결 계층 (Network Access Layer/Network Interface Layer)

**데이터 단위**: 프레임  
**전송 주소** : MAC

- 물리적으로 데이터가 네트워크를 통해 어떻게 전송되는지를 정의
  - 논리주소(IP주소 등)이 아닌 물리주소(예. MAC주소(Media Access Control address))을 참조해 장비간 전송
  - MAC주소란 컴퓨터의 하드웨어 주소
- 기본적으로 에러검출 / 패킷의 프레임화 담당
- 프레임(Frame)단위의 데이터 구성
  - 최종적으로 데이터 전송을 하기 전 패킷헤더에 MAC주소와 오류 검출을 위한 부분을 첨부

#### 예시

MAC, LAN, 패킷망 등에 사용되는 것  
예) Ethernet, PPP, Token Ring 등

### 2계층 - 인터넷 계층(Internet Layer)

**데이터 단위**: 패킷  
**전송 주소**: IP

- 네트워크상 최종 목적지까지 정확하게 연결되도록 연결성을 제공
- 단말을 구분하기위해 논리적인 주소(Logical Address) IP를 할당
  - 출발지와 목적지의 논리적 주소가 담겨있는 IP datagram이라는 패킷으로 데이터를 변경
  - 데이터 전송을 위한 주소 지정
- 라우팅(Routing) 기능을 처리
  - 경로 설정
- 최종 목적지까지 정확하게 연결되도록 연결성 제공
- 패킷단위의 데이터 구성
  - 세그먼트를 목적지까지 전송하기 위해 시작 주소와 목적지의 논리적 주소를 붙인 단위. 데이터 + IP Header

#### 예시

IP, ARP, ICMP, RARP, OSPF

### 3계층 - 전송 계층(Transport Layer)

**데이터 단위**: Segment  
**전송 주소**: Port

- 통신 노드 간의 연결 제어 및 자료 송수신을 담당
- 애플리케이션 계층의 세션과 데이터그램 통신서비스 제공
- 세그먼트 (Segment)단위의 데이터 구성
  - 실질적인 데이터 전송을 위해 데이터를 일정 크기로 나눈 것. 발신, 수신, 포트주소, 오류검출코드가 붙게된다

#### 예시

TCP, UDP, RTP, RTCP 등

### 4계층 - 응용 계층(Application Layer)

**데이터 단위**: Data/Message

- 사용자와 가장 가까운 계층으로 사용자가 소프트웨어 application과 소통할 수 있게 해준다
- 응용프로그램(application)들이 데이터를 교환하기 위해 사용되는 프로토콜
- 사용자 응용프로그램 인터페이스를 담당

#### 예시

파일 전송, 이메일, FTP, HTTP, SSH, Telnet, DNS, SMTP 등

## 캡슐화/비캡슐화

### 계층 간 데이터 송수신 과정

- 계층 간 데이터 송수신 과정: 애플리케이션 계층에서부터 링크계층까지 요청값이 캡슐화 과정을 거쳐 전달→ 상대의 링크 계층을 통해 해당 서버와 통신→링크 계층으로부터 애플리케이션 계층까지 비 캡슐화 과정을 거쳐 전송
  
  ![Untitled](https://user-images.githubusercontent.com/47595515/207834590-d8cf88d4-2cb5-4ec2-b139-eda9188bee7e.png)
  

### 캡슐화 과정

- 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고, 해당 계층의 헤더를 삽입하는 과정
- 애플리케이션 계층의 데이터가 전송 계층으로 전달되면서 ‘세그먼트’ 또는 ‘데이터그램’화 되며 TCP(L4) 헤더가 붙여지게된다.

![Untitledpng](https://user-images.githubusercontent.com/47595515/207834596-44f489d2-07d4-45a5-ac14-cae02f06a13c.png)

### 비캡슐화 과정

- 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정
- 캡슐화된 데이터를 받게 되면 링크 계층에서부터 타고 올라가면서 최종적으로 사용자에게 메시지(애플리케이션의 PDU)로 전달된다.

![Untitled](https://user-images.githubusercontent.com/47595515/207834613-281da847-4b17-4ef1-8f9a-09d01c8e9e50.png)

## PDU(Protocol Data Unit)

- 네트워크의 어떤 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위
- PDU는 제어 관련 정보들이 포함된 ‘헤더’, 데이터를 의미하는 ‘페이로드’로 구성되어 있으며, 계층마다 부르는 명칭이 다르다.
- 메시지 - 세그먼트(TCP)/데이터그램(UDP) - 패킷 - 프레임(데이터링크)/비트(물리계층)
  - 패킷 : SP와 DP가 포함된 IP헤더가 붙은 형태의 조각
  - 프레임: MAC주소헤더+CRC/체크섬트레일러
    - crc/체크섬트레일러: 데이터의 오류 감지를 위한 수학적 함수가 적용된 값. 링크의 오류로 인한 데이터 손상을 감지하는 역할을 한다.
- PDU중 가장 아래 계층인 비트로 송수신 하는 것이 가장 빠르고 효율성이 높다.
- 문자열 기반 송수신을 하면 헤더에 AUTHORIZATION값 등 다른 값들을 넣는 확장이 쉽기 때문에, 애플리케이션 계층에서는 문자열을 기반으로 송수신을 한다.
