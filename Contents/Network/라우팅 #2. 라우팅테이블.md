---
# 라우팅과 라우팅 테이블
---

## 1. 인터넷의 데이터 교환 방식
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/b5e47918-af07-4313-8376-eb7fc9a981b7)
- 네트워크는 노드와 링크로 구성
- 네트워크는 상호 연결된 노드의 모임으로, 중간 노드를 경유하며 송신지 호스트에서 수신지 호스트로 데이터가 전송
- 송신 호스트가 전송한 데이터가 중간 노드에 도착하면 노드는 연결된 링크 중 최적 링크를 선택하고, 이 과정이 반복되며 데이터 전송
- 송신 호스트에서 수신 호스트로 데이터를 전송할 때 노드가 연결된 링크 중에서 어떤 링크를 거쳐 데이터를 이동시킬 것인지, 
  즉, 송신 호스트에서 수신 호스트까지 가는 다양한 이동 경로 중에 어떤 경로를 선택해서 데이터를 전송할 것인지 결정하는 방법에는 
  크게 1) 회선 교환 방식과 2) 패킷 교환 방식이 존재
<br/>

### 1-1. 회선 교환 방식
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/065a9986-884b-474e-aec2-993379b19bba)

- 통신하고자 하는 두 호스트가 데이터를 전송하기 전에 미리 하나의 고정된 이동 경로를 설정하는 방식
- 미리 설정된 이동 경로는 두 호스트만이 독점적으로 사용하는 전용 경로가 되며, 통신을 종료할 때까지 변경되지 않기 때문에 모든 데이터가 같은 경로로 전달
- 가령, 호스트 A가 호스트 D에게 데이터를 전송하기 전에 노드 ① ⇒ 노드 ④ ⇒ 노드 ⑦을 거치는 이동 경로를 설정하면, 
  두 호스트 간에 통신이 종료될 때까지 모든 데이터는 이 이동 경로로만 전송
- 외형상 호스트 A와 호스트 D 간에 가장 효율적인 경로는 노드 ① ⇒ 노드 ④ ⇒ 노드 ⑦을 거치는 이동 경로이지만, 데이터 전송 시점에 노드 ④의 트래픽이 많은 경우라면 
  오히려 노드 ① ⇒ 노드 ③ ⇒ 노드 ⑥ ⇒ 노드 ⑦의 경로나 노드 ① ⇒ 노드 ② ⇒ 노드 ⑤ ⇒ 노드 ⑦의 경로가 더 효율적인 이동 경로일 수 있음
- 어떤 이동 경로가 더 나을지는 데이터를 전송하는 시점의 네트워크 혼잡도 등 여러 요인에 따라 달라지는 데 회선 교환 방식은 데이터 전송 전에 미리 이동 경로를 결정하기 때문에
  데이터 전송 시의 이동 경로가 효율적이지 못한 경우가 발생
- 또한, 회선 교환 방식을 사용하면 이미 설정된 이동 경로는 설정이 해제되기 전까지 데이터를 전송하지 않을 때에도 다른 호스트가 이 이동 경로를 사용할 수 없게 된다는 측면에서도 비효율적
- 이러한 회선 교환 방식의 비효율성을 개선한 것이 패킷 교환 방식!
 <br/>

### 1-2. 패킷 교환 방식
- 패킷 교환 방식은 미리 고정된 이동 경로를 설정하지 않는 대신 데이터를 패킷이라고 하는 작은 단위로 나누어 전송하는 방식
- 패킷은 네트워크에서 데이터를 전송하기 쉽도록 분할한 전송의 기본 단위(** 하단 계층별 데이터 전송단위 표 참고)

![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/bdbd7baf-fab6-4f0e-ba81-287d5f93d545)

- 데이터는 네트워크를 통해 전송되기 전에 패킷이라는 작은 조각으로 나뉘는데, 
  이때 각 패킷에는 고유 번호가 있어서 네트워크를 거쳐 최종 수신지에 전송되었을 때 원래의 데이터로 재결합
- 각 패킷은 전송 당시 가장 효율적인 경로를 각자 설정해 최종 수신지까지 이동
- 즉, 큰 데이터를 작은 단위인 패킷으로 나눠 놨기에 각 패킷은 미리 정해진 경로가 없이 전송 당시의 상황에 따라 매번 다른 경로로 전송 가능하여 효율적
- 패킷 교환 방식의 데이터 전송이 가능하기 위해선 패킷을 수신한 중간 노드가 패킷의 수신지 호스트를 확인하고 
  수신지 호스트까지 가는 다양한 경로 중 그 당시 가장 좋다고 판단되는 경로를 따라 다음 중간 노드로 패킷을 전송하는 기능인 '라우팅'을 수행해야 함
- 송신 호스트에서는 네트워크가 사용하는 프로토콜을 사용하여 데이터를 작은 단위로 분할하고, 분할된 데이터 앞에 패킷의 번호, 패킷의 송신지 및 수신지 등 
  패킷의 전송을 제어하기 위한 정보를 담은 패킷 헤더를 붙여 패킷이라는 형태로 변환하여 네트워크로 전송. 이때 데이터가 패킷이라는 단위로 변환되는 과정이 바로 캡슐화
  
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/8b40f454-1596-4a71-ab05-8077b818902a)
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/3cd98d6c-d113-46d0-9df5-93e3ca8546e9)

- 위와 같이 송신 호스트 A가 수신 호스트 D로 전송할 데이터는 패킷으로 나누어져 각 패킷은 중간 노드인 라우터의 라우팅에 따라 각자 최적 경로를 판단 후 다른 경로로 이동
- 이처럼 송신 호스트가 전송한 각 패킷들은 서로 독립적인 라우팅 과정을 거쳐 수신 호스트에 도착하기 때문에 패킷마다 전송에 걸리는 시간이 다르고, 
  출발한 순서와 무관하게 수신 호스트에 도착하므로 패킷 간 전송 순서가 보장되지 않기 때문에 수신지 호스트에서는 송신지 호스트가 전송한 패킷이 모두 도착하면 프로토콜을 사용하여 패킷 헤더를 읽고 패킷의 순서를 다시 정리해서 원래의 데이터로 패킷을 재결합
- 이러한 효율성 때문에 정보통신 네트워크에서 데이터는 패킷이라는 작은 단위로 분할되어 라우터를 통해 전송되는 것이 표준화됨
<br/>
 
### 참고: 캡슐화
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/a7eb48b3-b656-4af9-a409-8d9f3c5297c3)
<br/>
<br/>
<br/>


## 2. 라우팅과 라우터
### 2-1. 라우팅
- 네트워크 상의 주소를 이용하여 목적지까지의 최적 경로를 찾는 경로선택 과정, 이를 수행하는 장비가 라우터
- 수동으로 미리 경로를 정하는 정적 라우팅 (Static Routing)과 망의 상태에 따라 자동으로 경로가 선택되는 동적 라우팅 (Dynamic Routing)으로 구분
- 라우팅 알고리즘으로는 거리벡터 알고리즘과 링크상태 알고리즘이 존재
- 라우팅 프로토콜로는 자치시스템 내부에서의 라우팅인 RIP, OSPF, IGRP가 존재하고, 자치시스템 외부 간의 라우팅인 EGP, BGP가 존재

### 참고: 정적 라우팅과 동적 라우팅의 장단점
#### (1) 정적 라우팅
- 목적지 경로를 관리자가 직접 설정
- 데이터가 전달되는 경로를 관리자가 직접 제어하여 안정성이 높음
- 하지만 라우터가 많고 목적지가 많은 경우 설정이 여렵고 장애가 발생했을 경우 대체가 어려움

#### (2) 동적 라우팅
- 라우팅 프로토콜을 통해 라우터 간에 경로 정보를 교환해 최적의 경로를 결정
```
RIP    (거리 백터 라우팅 프로토콜)
OSPF   (링크 상태 라우팅 프로토콜)
EIGRP  (향상된 거리 백터 프로토콜)
BGP  (경로 백터 라우팅 프로토콜)
```
- 데이터가 전달되는 경로를 자동으로 결정하므로 장애가 발생할 경우 대처가 쉬움
- 하지만, 데이터가 전달되는 경로를 관리자가 제어할 수 없기에 안정성이 낮고 장애가 발생할 가능성 있음
<br/>

### 2-2. 라우터
- 각기 독립된 네트워크들을 연결/분할 시켜주는 장치
- 포워딩(패킷 스위칭)과 라우팅(경로 설정) 수행
- 포워딩은 한 포트로 패킷을 받아서(입력), 다른 포트로 전송(출력)하는 행위
- 라우팅은 라우터끼리 상호연결된 복잡한 망에서 경로의 배정 및 제어를 하는 행위(자동적으로 수행)
- 라우팅을 할 때 라우터는 라우터 상호간에 라우팅 정보를 주고받으며, 동적으로 라우팅 테이블을 만들어 감
- 즉, 라우터는 라우팅 테이블을 구축하는데 이것이 라우터의 가장 중요한 임
- 라우터의 내부에는 1) 라우팅 소프트웨어와 2) 라우팅 테이블이 존재
- 라우팅 소프트웨어는 수신받은 매 데이터그램의 목적지 주소를 조사
- 라우터는 라우팅 소프트웨어를 통해 수신받은 목적지 주소를 바탕으로
  다시 메모리에서 구축된 라우팅 테이블을 참조하여 출력 포트들 중 하나를 통해 데이터그램을 적절하게 포워딩함
<br/>
<br/>
<br/>


## 3. 라우팅 테이블

### 3-1. 포워딩 테이블 
- 입출력 포트 연결 테이블(입력 포트의 수신 패킷을 어느 출력 포트로 보낼 것인가를 나타낸 표 테이블)
- 스위치 및 라우터 장비 모두가, 포워드 테이블을 관리

### 3-2. 라우팅 테이블
- 포워딩 테이블 및 최적 라우팅 정보를 모두 나타낸 표 테이블
- 라우터 장비 내 RAM 상에서 관리
- 라우터는, 라우팅 테이블에 담긴 정보를 바탕으로 경로를 선택하며, 패킷을 다음 라우터로 전달함

### 3-3. 라우팅 테이블이 담기는 정보
- ``` 1) 목적지, 2) 방향, 3) 거리 ```
- 라우터는 자원 절약을 위해 라우팅 테이블에 호스트 주소 단위가 아닌, ```목적지 네트워크 주소``` 단위로 정보를 저장하고 관리
- 라우터는 ```패킷의 입출력 방향```을 라우팅 테이블에 저장
- 패킷의 입출력 방향은 목적지의 네트워크 주소로 가기 위한 라우터의 출구 포트에 대한 정보를 의미
- 라우터는 라우팅 테이블에 ```목적지로의 라우팅을 위한 메트릭 정보```를 저장

### 3-4. 라우터의 최적 경로 계산
- 라우터는 최적 경로 계산 시 보통 6개 정도를 계산하고 이들 사이에 트래픽을 로드 밸런싱(부하 분산) 함
- 만일, 동일 목적지 경로에 대한 정보가 인접 라우터들로부터 여럿 수신된다면, 비용이 더 적게 소요되는 정보를 취사 선택
- 결국, 라우터는 모든 목적지 네트워크 마다 최적 경로가 결정된 표를 만들고, 각 노드들은 원격 네트워크 경로에 대해 계산된 어떤 수치 값(메트릭 값)을 가지고 이 매트릭 값을 이용하여 최적 경로 선정
- 라우팅 테이블에 최적 경로인 라우팅 정보를 학습시키기 위해서는 두 가지 방법이 존재
- 정적 라우팅 방식과 동적 라우팅 방식
- 정적 라우팅은 네트워크 관리자가 라우팅 테이블에 라우팅 정보를 하나하나 등록하는 방법
- 동적 라우팅은 라우팅 정보를 다른 라우터에게 자동으로 받는 방법(라우팅 프로토콜 사용)


### 3-5. 라우팅 테이블의 구체적인 요소
![image](https://github.com/jeonseongjae98/cs-study/assets/114549688/0cc24858-63d9-4780-b782-26f1dc0011a7)

- `네트워크 대상 (Network Destination)`: 목적지 네트워크의 IP 주소
- `서브넷 마스크 (Netmask)`: 대상 주소를 설명할 때 쓰이는 값, 목적지 네트워크의 넷마스크 주소
- `게이트웨어 (Gateway)`: 외부 네트워크와 연결하기 위한 게이트웨이 주소
    - 네트워크와 네트워크를 잇는 장치
    - 이 장치와 연결되어있는 홉
    - 패킷이 전달되는 다음 IP 주소 (외부 네트워크와 연결된 장치)
    - 만약 목적지가 로컬 네트워크라면 ‘연결됨(connected)’라고 표기됨
    - 목적지가 다른 네트워크라면 해당 네트워크의 게이트웨이를 표기
- `인터페이스 (Interface)`: 게이트웨이로 가기 위해 거치는 장치
- `메트릭 (Metric)`: 패킷 전송을 위해 최적의 경로가 선택되도록 참고되는 값
    - 매트릭에는 일반적으로는 홉 수가 들어가며 지연시간이나 처리량 등이 들어갈 수 있음
    - 동일한 라우팅 테이블 요소가 2개 있을 때 매트릭의 값이 낮은 요소가 선택


### 3-6. 홉 카운트(hop count)
![Untitled](https://yj-ssafy.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe6500ac8-9a6d-479d-a3ef-603ab3e66758%2FUntitled.png?table=block&id=8ba9373d-2752-47fb-a116-ceb410dfeff8&spaceId=38a82801-f337-4f03-ba13-3c751e08d5b3&width=1920&userId=&cache=v2)

- 패킷이 다음 네트워크 장비로 이동할 때마다 홉이 하나 발생
- 홉 수는 송신지와 수신지(목적지) 사이에 위치한 장치(브리지, 라우터, 게이트웨이 등)를 몇 번 거쳤는지의 횟수
- 상황에 따라 다르지만 일반적으로 홉 카운트가 낮을수록 최적의 경로를 의미
- 즉, 매트릭의 값이 작을수록 최적 경로로 선택될 확률이 높음
<br/>
<br/>
<br/>

        
## 문제 1.
#### OSI 7계층 에서 3계층인 네트워크 계층에 속하며 LAN과 LAN또는 LAN과 WAN등을 연결하는 인터넷 네트워크 장치로, 네트워크 계층 간을 연결하여 접속할 호스트의 최적 경로를 설정하는 장치는?

## 문제 2.
#### 네트워크 A상의 호스트가 네트워크 B상의 호스트로 메시지를 보낼 때, 라우터가 찾는 주소는? 

## 문제 3.
#### 패킷을 다음 홉으로 전달하는 행위는?



<details>
<summary>정답</summary>
<div>

라우터, IP 주소, 포워딩

</div>
</details>
