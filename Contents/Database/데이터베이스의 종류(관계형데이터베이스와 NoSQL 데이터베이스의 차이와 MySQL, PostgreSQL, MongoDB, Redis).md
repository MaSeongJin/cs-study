## 시작하기 전에!💡
- 우린 웹 앱을 개발할 때, 데이터베이스를 선택할 때 고민하겠죠?
- ```MySQL과 같은 SQL을 사용할까? 아니면 MongoDB와 같은 NoSQL을 사용할까?```
- 보통 Spring에서 개발할 때는 MySQL을, Node.js에서는 MongoDB를 주로 사용한다고 합니다.
- 하지만 그냥 단순히 프레임워크에 따라 결정하는 것이 아닙니다! 프로젝트를 진행하기에 앞서 적합한 데이터베이스를 택해야 합니다.
- 그러므로 차이점을 잘 알아야겠죠?

# RDBMS와 NoSQL의 차이점

### Database와 DBMS 그리고 SQL
- Database란 일반적으로 컴퓨터 시스템에 전자 방식으로 저장된 구조화된 정보 또는 데이터의 체계적인 집합을 의미합니다.
- DBMS란(DataBase Management System) 사용자와 데이터베이스 사이에서 사용자의 요구에 따라 정보를 생성해 주고 데이터베이스를 관리해 주는 소프트웨어입니다.
- SQL이란(Strucured Query Language) 관계형 데이터베이스 관리 시스템의 데이터를 관리하기 위해 설계된 특수 목적의 프로그래밍 언어이며 관계형 데이터베이스 관리 시스템에서 자료의 검색과 관리, 데이터베이스 스키마 생성과 수정, 데이터베이스 객체 접근 조정 관리를 위해 고안되었습니다.

## RDBMS(=관계형 데이터베이스 관리 시스템)
- 기존의 RDBMS에서의 저장 방식은 SQL에 의해 저장되고 있으며 정해진 스키마에 따라 데이터를 저장하여야 합니다. RDBMS에는 DBMS앞에 R이 붙어 있습니다. 이 R은(Relational)의 약자로 RDBMS는 관계형 데이터베이스 관리 시스템을 의미합니다. 이름과 같이 RDBMS는 RDB를 관리하는 시스템이며 RDB는 관계형 데이터 모델을 기초로 두고 모든 데이터를 2차원 테이블 형태로 표현하는 데이터베이스입니다. 
</br>
관계형 데이터베이스(RDMBS)는 아래와와 같이 구성된 테이블이 다른 테이블들과 관계를 맺고 모여있는 집합체로 이해할 수 있습니다. 관계형 데이터베이스(RDMBS)에서는 이러한 관계를 나타내기 위해 외래 키(foreign key)라는 것을 사용합니다. 이러한 테이블간의 관계에서 외래 키를 이용한 테이블 간 Join이 가능하다는 게 RDBMS의 가장 큰 특징입니다.
</br>

[![3.png](https://i.postimg.cc/pLhPr5hP/3.png)](https://postimg.cc/ZWSGDRxQ)

</br>

**외래키**는 두 테이블을 서로 연결하는 데 사용되는 키이다. 외래키가 포함된 테이블을 자식 테이블이라고 하고 외래키 값을 제공하는 테이블을 부모 테이블이라고 한다.
그러므로, 위와 같이 회원 테이블의 기본키인 회원 번호를 주문 테이블에 추가하면, 중복된 데이터가 없으면서도 문제 없이 데이터를 저장, 관리할 수 있게 됩니다.

## NoSQL(비관계형 DB)
- NoSQL이란(Not Only SQL)의 약자로 말 그대도 위에서 설명한 RDB 형태의 관계형 데이터베이스가 아닌 다른 형태의 데이터 저장 기술을 의미하고 있습니다. 또한 NoSQL에서는 RDBMS와는 달리 테이블 간 관계를 정의하지 않습니다. 데이터 테이블은 그냥 하나의 테이블이며 테이블 간의 관계를 정의하지 않아 일반적으로 테이블 간 Join도 불가능합니다.

- NoSQL은 점점 빅데이터의 등장으로 인해 데이터와 트래픽이 기하급수적으로 증가함에 따라 RDBMS에 단점인 성능을 향상시키기 위해서는 장비가 좋아야 하는 Scale-Up의 특징이 비용을 기하급수적으로 증가시키기 때문에 데이터 일관성은 포기하되 비용을 고려하여 여러 대의 데이터에 분산하여 저장하는 Scale-Out을 목표로 등장하였습니다.

- NoSQL을 하면 가장 유명한 Document 기반의 MongoDB를 많이 떠올리지만 MongoDB는 NoSQL한 종류로 NoSQL은 아래와 같이 다양한 형태의 저장 기술을 지원하고 있습니다. 이 다양한 형태의 저장기술은 RDBMS 스키마에 맞추어 데이터를 관리해야 된다는 한계를 극복하고 수평적 확장성(Scale-out)을 쉽게 할 수 있다는 장점을 가지고 있습니다.
	- 여기서 잠깐💡 **스케일 업(Scale-up)?** **스케일 아웃(Scale-out)?**
		- 스케일 업(Scale-up)은 쉽게 말하면 기존의 서버를 보다 높은 사양으로 업그레이드하는 것을 말한다. 하드웨어적인 예를 들면, 성능이나 용량 증강을 목적으로 하나의 서버에 디스크를 추가하거나 CPU나 메모리를 업그레이드시키는 것을 말한다. 이처럼 하나의 서버의 능력을 증강하기 때문에 수직 스케일링(vertical scaling)이라고도 한다.

		[![136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png](https://i.postimg.cc/brMz84c9/136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png)](https://postimg.cc/H8wG9ZLr)

		</br>
			
		- 스케일 아웃(Scale-out)은 장비를 추가해서 확장하는 방식을 말한다. 기존 서버만으로 용량이나 성능의 한계에 도달했을 때, 비슷한 사양의 서버를 추가로 연결해 처리할 수 있는 데이터 용량이 증가할 뿐만 아니라 기존 서버의 부하를 분담해 성능 향상의 효과를 기대할 수 있다. 서버를 추가로 확장하기 때문에 수평 스케일링(horizontal scaling)이라고도 불린다.
		
		[![136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png](https://i.postimg.cc/PfFfmvpv/136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png)](https://postimg.cc/G9G1R2jb)

## NoSQL 특징

[![136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png](https://i.postimg.cc/zGzcpZzc/136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png)](https://postimg.cc/8jY4PYrR)

1. Key-Value Database </br>
	Key-Value Database는 데이터가 Key와 Value의 쌍으로 저장된다. Key는 Value에 접근하기 위한 용도로 사용되며, 값은 어떠한 형태의 데이터라도 담을 수 있다. 심지어는 이미지나 비디오도 가능하다. 또한 간단한 API를 제공하는 만큼 질의의 속도가 굉장히 빠른 편이다.
	대표적인 **NoSQL Key-Value Model로는 Redis(=레디스), Riak(=리아크), Amazon Dynamo DB(=아마존 다이나모디비)** 등이 있다.
 

2. Document Database
[![136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png](https://i.postimg.cc/52skR7jN/136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png)](https://postimg.cc/tsV51zhL)

	Document Database 데이터는 Key와 Document의 형태로 저장된다. Key-Value 모델과 다른 점이라면 Value가 계층적인 형태인 도큐먼트로 저장된다는 것이다. 객체지향에서의 객체와 유사하며, 이들은 하나의 단위로 취급되어 저장된다. 다시 말해 하나의 객체를 여러 개의 테이블에 나눠 저장할 필요가 없어진다는 뜻이다. 
	주요한 특징으로는 객체-관계 매핑이 필요하지 않다. 객체를 Document의 형태로 바로 저장 가능하기 때문이다. 또한 검색에 최적화되어 있는데, 이는 Key-Value 모델의 특징과 동일하다. 단점이라면 사용이 번거롭고 쿼리가 SQL과는 다르다는 점이다. 도큐먼트 모델에서는 질의의 결과가 JSON이나 xml 형태로 출력되기 때문에 그 사용 방법이 RDBMS에서의 질의 결과를 사용하는 방법과 다르다. 
	대표적인 NoSQL Document Model로는 MongoDB(=몽고디비), CouchDB(=카우치디비) 등이 있다.
 

3. Wide Column Database</br>
[![image.png](https://i.postimg.cc/52pmbLS0/image.png)](https://postimg.cc/xXJmPk7D)

	Column-family Model 기반의 Database이며 이전의 모델들이 Key-Value 값을 이용해 필드를 결정했다면, 특이하게도 이 모델은 키에서 필드를 결정한다. 키는 Row(키 값)와 Column-family, Column-name을 가진다. 연관된 데이터들은 같은 Column-family 안에 속해 있으며, 각자의 Column-name을 가진다. 관계형 모델로 설명하자면 어트리뷰트가 계층적인 구조를 가지고 있는 셈이다. 이렇게 저장된 데이터는 하나의 커다란 테이블로 표현이 가능하며, 질의는 Row, Column-family, Column-name을 통해 수행된다.
	대표적인 **NoSQL Column-family Model로는 HBase(=에이치베이스), Hypertable(=하이퍼테이블)** 등이 있다.
 

5. Graph Database</br>
	[![3.png](https://i.postimg.cc/DzV2pPZD/3.png)](https://postimg.cc/bZTcsb1H)
	Graph Model Database에서는 데이터를 Node와 Edge, Property와 함께 그래프 구조를 사용하여 데이터를 표현하고 저장하는 Database입니다. 개체와 관계를 그래프 형태로 표현한 것이므로 관계형 모델이라고 할 수 있으며, 데이터 간의 관계가 탐색의 키일 경우에 적합하다. 페이스북이나 트위터 같은 소셜 네트워크에서(내 친구의 친구를 찾는 질의 등) 적합하고, 연관된 데이터를 추천해주는 추천 엔진이나 패턴 인식 등의 데이터베이스로도 적합하다.
	대표적인 **NoSQL Graph Model로는 Neo4J(=네오포제이)**가 있다.


## RDBMS와 NoSQL의 장단점
### RDBMS
- **MySQL, PostgreSQL(=포스트그레스큐엘), 오라클, SQL Server, MSSQL**
1. 장점 </br>
- RDBMS는 위에서 설명을 하였듯이 정해진 스키마에 따라 데이터를 저장하여야 하므로 명확한 데이터 구조를 보장하고 있습니다. 
- 또한 관계는 각 데이터를 중복없이 한 번만 저장할 수 있습니다.
2. 단점 </br>
- 테이블간테이블 간 관계를 맺고 있어 시스템이 커질 경우 JOIN문이 많은 복잡한 쿼리가 만들어질 수 있습니다.
- 성능 향상을 위해서는 서버의 성능을 향상 시켜야하는 Scale-up만을 지원합니다. 이로 인해 비용이 기하급수적으로 늘어날 수 있습니다.
- 스키마로 인해 데이터가 유연하지 못합니다. 나중에 스키마가 변경 될 경우 번거롭고 어렵습니다.


### NoSQL
- Redis, HBase, MongoDB, Neo4J, Riak, Amazon Dynamo DB
1. 장점 </br>
- NoSQL에서는 스키마가 없기 때문에 유연하며 자유로운 데이터 구조를 가질 수 있습니다.
- 언제든 저장된 데이터를 조정하고 새로운 필드를 추가할 수 있습니다.
- 데이터 분산이 용이하며 성능 향상을 위한 Saclue-up 뿐만이 아닌 Scale-out 또한 가능합니다.
2. 단점 </br>
- 데이터 중복이 발생할 수 있으며 중복된 데이터가 변경 될 경우 수정을 모든 컬렉션에서 수행을 해야 합니다.
- 스키마가 존재하지 않기에 명확한 데이터 구조를 보장하지 않으며 데이터 구조 결정가 어려울 수 있습니다.

## 💡그럼 최종적으로 RDBMS, NoSQL 언제 사용해야 될까요?
- RDBMS는 데이터 구조가 명확하며 변경 될 여지가 없으며 명확한 스키마가 중요한 경우 사용하는 것이 좋습니다. 또한 중복된 데이터가 없어(데이터 무결성) 변경이 용이하기 때문에 관계를 맺고 있는 데이터가 자주 변경이 이루어지는 시스템에 적합합니다. 

- NoSQL은 정확한 데이터 구조를 알 수 없고 데이터가 변경/확장이 될 수 있는 경우에 사용하는 것이 좋습니다. 또한 단점에서도 명확하듯이 데이터 중복이 발생할 수 있으며 중복된 데이터가 변경될 시에는 모든 컬렉션에서 수정을 해야 합니다. 이러한 특징들을 기반으로 Update가 많이 이루어지지 않는 시스템이 좋으며 또한 Scale-out이 가능하다는 장점을 활용해 막대한 데이터를 저장해야 해서 Database를 Scale-Out를 해야 되는 시스템에 적합합니다.


# MySQL, PostgreSQL, MongoDB, Redis.

</br>

[![123.jpg](https://i.postimg.cc/bwsLJQqm/123.jpg)](https://postimg.cc/mPW7p1z9)

</br>

## MySQL
- 대부분의 운영체제와 호환되며 현재 가장 많이 사용하는 데이터베이스
- B-트리 기반의 인덱스, 스레드 기반의 메모리 할당 시스템, 매우 빠른 조인
- 다양한 스토리지 엔진 지원

💡 인덱스? </br>
원하는 데이터를 쉽게 찾을 수 있도록 돕는 것!, 즉, 조건을 만족하는 데이터를 인덱스를 통해 효과적으로 찾을 수 있도록 돕는다.

💡  B-트리 인덱스(트리 기반 인덱스)? </br>
B-Tree index는 DBMS에서 가장 일반적인 인덱스로, 트리 구조의 최상위에 하나의 "Root Block(Node)"가 존재하고 그 하위에 자식 Block(Node)이 붙어 있는 형태이다. 트리 구조의 가장 하위에 있는 노드를 "Leaf Block"이라 하며, Root Block도 아니고 Leaf Block도 아닌 중간 Block을 "Branch Block"이라고 한다. 데이터베이스에서 인덱스와 실제 데이터가 저장된 데이터는 따로 관리되는데, 인덱스의 Leaf Block은 항상 실제 데이터 레코드를 찾아가기 위한 주소값을 가지고 있다. 그렇다면 이러한 블록들을 이용해 원하는 데이터를 어떻게 찾아낼까?? 아래 그림은 B-트리 인덱스의 구조이다. </br>

[![136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png](https://i.postimg.cc/C5gbs8Tp/136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png)](https://postimg.cc/wywt67jw)

</br>

어떤 데이터의 주소 값을 알기 위해 인덱스 49번 블록의 값을 찾고 싶다면??

① 루트블록에서 60보다 작으므로 왼쪽 포인터로 이동 → ② 49는 브랜치블록의 40보다 크므로 오른쪽 포인터로 이동 → ③ 이동한 결과 해당 블록이 리프블록이므로 블록 내에 49를 검색 → ④ 찾아낸 주소 값(레코드 식별자)을 이용하여 테이블에서 원하는 데이터를 조회

## PostgreSQL
- 디스크 조각이 차지하는 영역을 회수할 수 있는 장치인 VACUUM이 특징
- 최대 테이블 크기 32TB

</br>

💡 VACUUM이란? </br>
VACUUM은 DB의 오래된 영역을 재사용하거나 정리 해주는 프로세스입니다.
PostgreSQL에서 특정 Row를 업데이트 할 경우, 디스크 상의 해당 Row를 물리적으로 업데이트하여 사용하지 않고, 새로운 영역을 할당해 쓰게 됩니다.
**즉, Update나 Delete 한다고 해서, 해당영역이 자동으로 재사용되거나 사라지지 않습니다. 이러한, 오래된 영역을 재사용하거나 정리해주는 명령어가 Vacuum 입니다.(변경 또는 삭제된 자료들이 차지하는 디스크 공간 재사용하기 위한 디스크 공간을 확보해 줍니다.)**

</br>

💡 디스크 조각이란? </br>
"디스크 조각"은 데이터베이스 시스템에서 사용되는 용어입니다. 이 용어는 데이터베이스의 저장 공간인 디스크에 저장된 데이터가 조각화되었을 때 사용됩니다. 데이터베이스 시스템에서 데이터를 추가, 수정 또는 삭제하면 데이터는 물리적으로 디스크에 저장되는데, 이 과정에서 데이터는 일부 공간에 조각화될 수 있습니다.

따라서 "디스크 조각"은 디스크에 저장된 데이터가 분산되어 저장되거나 공간이 낭비되는 상황을 가리키는 용어입니다. => 그래서 우리가 디스크 조각 모음을 하는거였음ㄷㄷ

## MongoDB
- 도큐먼트 기반의 데이터베이스
	[![136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png](https://i.postimg.cc/qRsSB8pN/136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png)](https://postimg.cc/9RfJJwR2)
- JSON을 통해 데이터 접근 가능({ “name” : “Hello World” })
- Binary JSON(BSON)로 데이터 저장
	- 바이너리(bonary) : 0과 1로만 이루어진 이진 형태
	- JSON으로 저장된 데이터를 바이너리로 인코딩한 형식입니다.
- 확장성이 뛰어남
	- 데이터와 트래픽 증가에 따라 수평확장이 가능합니다.
- 빅데이터를 저장할 때 성능이 좋음(고가용성, 샤딩, 레플리카셋 지원)
	- **고가용성**은 장애 발생 시에도 서비스를 유지하는 능력을 의미하며, **샤딩**은 대용량 데이터를 여러 노드 또는 서버에 분산하여 저장하고 검색할 수 있는 데이터베이스 확장 기술로 데이터베이스 확장 방법입니다. **레플리카셋**은 고가용성을 제공하기 위한 메커니즘 중 하나로, 데이터를 여러 노드에 복제하여 시스템의 신뢰성을 향상시킵니다.
- 도큐먼트 생성시 마다 중복된 값을 지니기 힘든 유니크한 값 ObjectID 생성
	- 타임스탬프(4), 랜덤값(5), 카운터(3)
	[![136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png](https://i.postimg.cc/j2qqQq5S/136900399-b4615b3a-8afa-4950-9513-9ce35748588f.png)](https://postimg.cc/mzqGTsCv)


## Redis
[![136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png](https://i.postimg.cc/1XWmWxnc/136903171-2fa97983-a678-4fda-8128-ff007ab95c84.png)](https://postimg.cc/SYMbsvGJ)
- 사용자가 늘어난다면 데이터 베이스가 과부하 될 수 있기 때문에 이때 캐시 서버를 도입하여 사용합니다. 그리고 이 캐시 서버로 이용할 수 있는 것이 바로 Redis 입니다.
- Key, Value 구조이기 때문에 쿼리를 사용할 필요가 없습니다.
- 인메모리 데이터베이스
	- 인메모리란 컴퓨터의 메인 메모리 RAM에 데이터를 올려서 사용하는 방법을 말한다. 왜 메모리에 데이터를 올릴까? 이유는 명확하게도 속도 때문이다.  SSD,HDD 같은 저장공간에서 데이터를 가져오는 것보다 RAM에 올려진 데이터를 가져오는데 걸리는 속도가 수백배(HDD 기준) 이상 빠르다. 때문에 Redis는 빠른 속도가 큰 장점이다.
- 데이터 타입은 문자열(String)
- pub/sub 기능을 통해 채팅 시스템, 세션 정보 관리, 실시간 순위표 등에 사용
	- Redis는 인메모리 데이터베이스로 데이터를 메모리에 저장하므로 데이터에 대한 읽기와 쓰기가 빠르게 처리되어 실시간 순위표와 같이 실시간 관련 기능 구현에 사용!


💡 pub/sub이란? </br>
[![3.png](https://i.postimg.cc/TP6H7t8p/3.png)](https://postimg.cc/tsB57t4j)
Publish / Subscribe 란 특정한 주제(topic)에 대하여 해당 topic을 구독한 모두에게 메시지를 발행하는 통신 방법으로 채널을 구독한 수신자(클라이언트) 모두에게 메세지를 전송 하는것을 의미한다. 하나의 Client가 메세지를 Publish하면, 이 Topic에 연결되어 있는 다수의 클라이언트가 메세지를 받을 수 있는 구조이다.

쉽게 생각하면, Youtube 채널 구독과 비슷하다. 구독과 좋아요(Subscribe )를 누르면, 나중에 크리에이터가 새로운 글을 발행(Publish)하면 구독자 한테만 알림(notification)이 오게 되는 원리라고 보면 된다.


### 문제1. 빅데이터 저장기술 중 옳은 것은?
1. 맵리듀스
2. 직렬화
3. 가시화
4. NoSQL

답: 4번

### 문제2. 다음 중 NoSQL 저장방식이 아닌 것은?
1. MongoDB 
2. Redis
3. PostgreSQL
4. Neo4J

답: 3번



